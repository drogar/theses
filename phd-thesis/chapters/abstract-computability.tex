%!TEX root = /Users/gilesb/UofC/thesis/phd-thesis/phd-thesis.tex

\chapter{Abstract Computability}\label{chap:abstract_computability}
\section{Categories} % (fold)
\label{sec:categories}

A category as a mathematical object can be defined in a variety of equivalent ways. As much of our
work will involve the exploration of partial and reversible maps, their domains and ranges, we
choose a definition that highlights the algebraic nature of these. Note that ranges are normally
referred to as codomains in category theory and we will use the codomain terminology in this
section.

\begin{definition}\label{def:category}
  A \emph{category} $\A$ is a collection of maps together with two functions, $D$ and $C$, from
  $\A$ to $\A$ and a partial associative composition of maps (written by juxtaposing maps), such
  that:
  \begin{itemize}
    \item[\catone] $D(f) f$ is defined and equals $f$,
    \item[\cattwo] $f C(f)$ is defined and equals $f$,
    \item[\catthree] $f g$ is defined iff $C(f) = D(g)$ and $D(f g) = D(f)$ and $C(f g) = C(g)$,
    \item[\catfour] $(f g) h = f (g h)$ whenever either side is defined,
    \item[\catfive] $D(C(x)) = C(x)$, $C(D(x)) = D(x)$ and $C,D$ are both idempotent.
  \end{itemize}
\end{definition}

A more familiar defintion, often used in introducing categories, is given next.

\begin{definition}\label{def:category_alt}
  A \emph{category} $\A$ is a directed graph consisting of objects $A_o$ and maps $A_m$. Each $f\in
  A_m$ has two associated objects in $A_o$, called the domain and codomain. When $f$ has domain $X$
  and codomain $Y$ we will write $f:X \to Y$. For $f, g \in A_m$, if $f:X\to Y$ and $g:Y \to Z$,
  there is a map called the \emph{composite} of $f$ and $g$, written $fg$ such that $fg:X \to Z$.
  For any $W \in A_o$ there is an \emph{identity} map $1_W:W \to W$. Additionally, these two axioms
  must hold:
  \begin{itemize}
    \item[\axiom{C'}{1}] for $f:X \to Y$, $1_X f = f = f 1_Y$,
    \item[\axiom{C'}{2}] given $f:X \to Y,\ g:Y \to Z$ and $h: Z\to W$, then $f (g h) = (f g) h$.
  \end{itemize}

\end{definition}

\begin{lemma}\label{lem:category_is_category_alt}
  A category as defined in Definition~\ref{def:category} is equivalent to a category as defined
  in Definition~\ref{def:category_alt} and vice versa.
\end{lemma}
\begin{proof}
  Assume $\A$ is as in Definition~\ref{def:category}. Then set $A_o$ to the collection of all
  $D(f)$ and $C(f)$. Set $A_m$ to all the maps in $\A$. The domain of any map $f \in A_m$ is $D(f)$
  and the codomain is $C(f)$. By \catthree, for $f:X\to Y$ and $g:Y \to Z$ the composite $fg$ is
  defined. The identity map of the object $D(f)$ is the map $D(f)$ and the identity map of the
  object $C(f)$ is $C(f)$. By \catfive, we see \axiom{C'}{1} is satisfied. By \catfour, we see
  \axiom{C'}{2} is satisfied. Therefore, $\A$ satisfies Definition~\ref{def:category_alt}.

  Conversely, assume $\Z$ is as in Definition~\ref{def:category_alt}. Then, we already have the
  collection of maps, $Z_m$. For each $f : A \to B \in Z_m$, set $D(f) = 1_A$ and $C(f) = 1_B$. By
  the definition of the identity maps and \axiom{C'}{1}, we see \catone, \cattwo and \catfive are
  all satisfied. From the compostion requirements on $\Z$ and \axiom{C'}{2}, it follows that
  \catfour is satisfied. For \catthree, assume $f g$ is defined. Then for some $A,B,C \in Z_o$,
  $f:A \to B$ and $g:B \to C$. This gives us $1_B = C(f) = D(g)$, $1_A = D(f g) = D_f$ and $1_B =
  C(f g) = C(g)$. Next, assume we have $C(f) = D(g)$, $D(f g) = D(f)$ and $C(f g) = C(g)$. This
  tells us the codomain of $f$ is some object $B$ which is also the domain of $g$, hence we may
  form the composition $f g$ which will have domain $A$, the domain of $f$ and codomain $C$, the
  codomain of $g.$
\end{proof}

As we have shown the two defintions are equivalent, it will be convenient to reference either
definition and manner of referring to a category thoughout this thesis. Essentially, we will use
whichever definition seems the most appropriate to use at any point.

We may also consider the notion of containment between categories.

\begin{definition}\label{def:subcategories}
  Given the categories $\C$ and $\D$, we may say the following:
  \begin{enumerate}[{(}i{)}]
    \item \C is a \emph{sub-category} of \D when each object of \C is an object of \D and when each map
    of \C is a map of \D.
    \item \C is a \emph{full sub-category} of \D when it is a sub-category and given $A, B$ objects
      in $\C$ and $f:A \to B$ in \D, then $f$ is a map in $\C$.
  \end{enumerate}
\end{definition}

\subsection{Enrichement of categories} % (fold)
\label{sub:enrichement_of_categories}
\begin{definition}\label{def:hom-collection}
  If $\X$ is a category, then $\X(A,B)$ is called a \emph{hom-collection} of $\X$ and consists
  of all arrows $f$ with $D(f) = A$ and $C(f) = B$.
\end{definition}

In the case where the hom-objects of a category $\X$ are all sets, we call them hom-sets. Additionally,
we say $\X$ is \emph{enriched} in \sets. We may extend this to any mathematical structure, e.g.,
enriched in partial orders, enriched in groups, etc..


Specific types of enrichment may force a specific structure on a category. For example, if $\X$ is
enriched in sets of cardinality of 0 or 1, then $\X$ must be a preorder.


% subsection enrichement_of_categories (end)
\subsection{Examples of categories} % (fold)
\label{sub:examples_of_categories}
In this section, we will offer a few examples of categories. As Definition~\ref{def:category_alt}
tends to be a more succinct way to present the data of a category, this section will given the
examples in terms of objects and maps rather than the ``object-free'' definition.


\subsubsection{Categories based on \protect{\sets}} % (fold)
\label{ssub:categories_based_on_sets}
There are three primary categories of interest to us where the objects are the collection of sets.
The first is \sets, where the maps are given by all set functions. The second is \Par, where the
maps are all partial maps. In each case, the standard definition of functions suffices to ensure
indenties, compositions and associativity are all satisfied. Domain and codomain are given by the
domain and range respectively.

A third example, often of interest in quantum programming language semantics is \rel:
\category{Sets}{Relations: $R:X \to Y$}{$1_X = \{(x,x) | x \in X\}$}{$RS = \{(x,z) |
\exists y, (x,y) \in R$ and $(y,z)\in S\}$}

Note that \rel is enriched in posets, via set inclusion. \Par can be viewed as a subcategory of
\rel, with the same objects, but only allowing maps which are functions, i.e., if $(x,y), (x,y')
\in R$, then $y = y'$. \Par is also enriched in posets, via the same inclusion ordering as in \rel.

% subsubsection categories_based_on_sets (end)
\subsubsection{Matrix categories} % (fold)
\label{ssub:matrix_categories}
Given a rig $R$ (i.e., a ring minus negatives, e.g., the positive rationals), one may form the
category \specialcat{Mat}($R$).
\category{\nat}{$[r_{ij}]: n \to m$ where $[r_{ij}]$ is an $n \times m$ matrix over $R$}{
$I_n$}{Matrix multiplication}
% subsubsection matrix_categories (end)

\subsubsection{Dual categories} % (fold)
\label{ssub:dual_categories}

Given a category $\C$, we may form the \emph{dual} of $C$, written $C^{op}$ as the following
category:
\category{The objects of $\C$}{$f^{op}:B\to A$ in $\C^{op}$ when $f:A\to B$ in $\C$.}{
The identity maps of $\C$}{If $f g = h$ in $\C$, $g^{op} f^{op} = h^{op}$}

% subsubsection dual_categories (end)
% subsection examples_of_categories (end)
\subsection{Properties of maps} % (fold)
\label{sub:properties_of_maps}
Many interesting properties of maps are generalizations of notions that have been found useful in
considering sets and functions. We present a few of these in a tabular format, together with their
categorical definition. Throughout the table, $e,f,g$ are maps in a category $C$ with
$e:A \to A$ and $f,g:A \to B$.
\\[14pt]

\begin{tabular}{|p{1in}p{1in}p{3.73in}|}
\hline
{\bf Sets} & {\bf Categorical Property} & {\bf Definition}\\
\hline
\hline
Injective & Monic & $f$ is monic whenver $h f = k f$ means that $h = k$.\\
\hline
Surjective & Epic & The dual notion to monic, $g$ is epic whenever $g h = g k$ means that $h = k$.
A map that is both monic and epic is called \emph{bijic}.\\
\hline
Left~Inverse & Section & $f$ is a section when there is a map $f^*$ such that $f f^* = 1_A$. $f$
is also referred to as the \emph{left inverse} of $f^*$.\\
\hline
Right Inverse & Retraction & $f$ is a retraction when there is a map $f_*$ such that $f_* f = 1_B$.
$f$ is also referred to as the \emph{right inverse} of $f_*$. A map that is both a section and a
retraction is called an \emph{isomorphism}.\\
\hline
Idempotent & Idempotent & An endomap $e$ is idempotent whenever $e e = e$.\\
\hline
\end{tabular}\\[14pt]

We state without proof a number of properties of maps.

\begin{lemma}\label{lem:categorical_properties_of_maps}
  In a category \C,
  \begin{enumerate}[{(}i{)}]
    \item If $f,g$ are monic, then $f g$ is monic.
    \item If $f g$ is monic, then $f$ is monic.
    \item $f$ being a section means it is monic.
    \item $f, g$ sections implies that $f g$ is a section.
    \item $f g$ a section means $f$ is a section.
  \end{enumerate}
\end{lemma}


\begin{lemma}\label{lem:categorical_inverses_are_unique}
  If $f:A \to B$ is both a section and a retraction, then $f^* = f_*$.
\end{lemma}

\begin{lemma}\label{lem:categorical_iso_is_epic_section}
  $f$ is an isomorphisim if and only if it is an epic section.
\end{lemma}

Note there are corresponding properties for epics and retractions, obtained by dualizing the
statements of Lemma~\ref{lem:categorical_properties_of_maps} and
Lemma~\ref{lem:categorical_iso_is_epic_section}.

Suppose $f:A \to B$ is a retraction with left inverse $f_*:B \to A$. Note that $f f_*$ is idempotent
as $f f_* f f_* = f 1_B f_* = f f_*$. If we are given an idempotent $e$, we say $e$ is \emph{split}
if there is a retraction $f$ with $e = f f_*$.

In general, not all idempotents in a category will split. The following construction allows us to
create a category based on the original one in which all idempotents do split.

\begin{definition}\label{def:split_category}
  Given a category $\C$ we define \emph{Split($\C$)} as the following category:
  \category{$(A,e)$, where $A$ is an object of \C, $e:A\to A$ and $e\in E$.}
    {$f_{d,e}:(A,d)\to(B,e)$ is given by $f:A\to B$ in \C, where $f = d\uts f e$.}
    {The map $e_{e,e}$ for $(A,e)$.}
    {Inherited from \C.}
\end{definition}

\begin{lemma}\label{lem:split_category_splits_and_has_category}
  Given a category $\C$, then it is a full sub-category of Split($\C$) and all idempotents split
  in Split($\C$).
\end{lemma}
\begin{proof}
  We identify each object $A$ in $\C$ with the object $(A,1)$ in Split($\C$). The only maps between
  $(A,1)$ and $(B,1)$ in Split($\C$) are the maps between $A$ and $B$ in $\C$, hence we have a
  full sub-category.

  Suppose we have the map $d_{e,e}: (A,e) \to (A,e)$ with $d d = d$, i.e., it is idempotent in $C$
  and Split($\C$). In Split($\C$), we have the map $d_{e,d}:(A,e) \to (A,d)$ and $d_{d,e}:(A,d) \to
  (A,e)$ where $d_{d,e} d_{e,d} = d_{d,d} = 1_{(A,d)}$ and $d_{e,d} d_{d,e} = d_{e,e}$, hence
  it is a splitting of the map  $d_{e,e}$.
\end{proof}
% subsection properties_of_maps (end)

\subsection{Limits and colimits in categories} % (fold)
\label{sub:limits_and_colimits_in_categories}

We shall discuss only a few basic limits/colimits in categories. First we discuss initial
and terminal objects.

\begin{definition}\label{def:initial_object}
  An \emph{initial object} in a category $\C$ is an object which has exactly one map to each other
  object in the category. The dual notion is \emph{terminal object} which has exactly one map from
  each other object in the category.
\end{definition}


\begin{lemma}\label{lem:initial_objects_are_unique}
  Suppose $I,J$ are initial objects in $\C$. Then there is an unique isomorphism $i:I \to J$.
\end{lemma}
\begin{proof}
  First, note that by definition there is only one map from $I$ to $I$ --- which must be the
  identity map. As $I$ is initial there is a map $i: I \to J$. As $J$ is intial there is a map
  $j:J \to I$. But this means $ij : I \to I = 1$ and $j i : J \to J = 1$ and hence $i$ is the
  unique isomorphism from $I$ to $J$.
\end{proof}

Dually, we have the corresponding result of Lemma~\ref{lem:initial_objects_are_unique} for terminal
objects --- they are also unique up to a unique isomorphism.

In categories, we normally designate the intial object by $0$ and the terminal object by $1$.

We now turn to products and co-products.

\begin{definition}\label{def:categorical_product}
  Let $A,B$ be objects of the category $\C$. Then the object $A \times B$ is a \emph{product} of
  $A$ and $B$ when:
  \begin{itemize}
    \item There exist maps $\pi_0, \pi_1$ with $\pi_0:A\times B \to A$, $\pi_1:A\times B \to B$;
    \item Given an object $C$ with maps $f:C\to A$ and $g:C \to B$ there exists an unique map
    $\<f,g\>$ such that the following diagram commutes:
    \[
      \xymatrix@C+15pt@R+25pt{
        &&&A\\
        C\ar[urrr]^{f} \ar[drrr]_{g}\ar@{.>}[rr]^{\<f,g\>} & &A\times B \ar[ur]_{\pi_0}\ar[dr]^{\pi_1}\\
        &&&B
      }
    \]
  \end{itemize}

\end{definition}
% subsection limits_and_colimits_in_categories (end)

\subsection{Functors and natural transformations} % (fold)
\label{ssub:functors_and_natural_transformations}

\begin{definition}\label{def:functor}
  A map $F:\X \to \Y$ between categories (as in Definition~\ref{def:category} is called a
  \emph{functor}, provided it satisfies the following:
  \begin{itemize}
    \item[\axiom{F}{1}] $F(D(f)) = D(F(f))$ and $F(C(f)) = C(F(f))$;
    \item[\axiom{F}{2}] $F(f g) = F(f)F(g)$;
  \end{itemize}
\end{definition}

\begin{lemma}\label{lem:cat_is_a_category}
  The collection of categories and functors form the category \cat.
\end{lemma}
\begin{proof}
  \category{Categories.}{Functors.}{The identity functor which takes a map to the same map.}{
  $FG(x) = F(G(x))$ which is clearly associative.}
\end{proof}

We will often restrict ourselves to specific classes of functors which either \emph{preserve} or
\emph{reflect} certain characteristics of the domain category or codomain category. To be more
precise, we provide some definitions.

\begin{definition}\label{def:diagram_in_a_category}
  A \emph{diagram} in a category is a collection of objects and maps between those objects
  which satisfy categorical composition rules. More precisely: Given a category $\S$, a diagram
  in a category $\C$ of \emph{shape} $\S$ is a functor $D:\S \to \C$.
\end{definition}

In practice, diagrams are pictorially represented by drawing the objects and the maps between them.

\begin{definition}\label{def:property_of_a_diagram}
  A \emph{property} of a diagram $D$, written $P(D)$ is a logical relation expressed using the
  objects and maps of the diagram $D$.
\end{definition}

\begin{example}
  $P(f:A \to B) = \exists h : B \to A. h f = 1_A$ expresses that $f$ is a retraction.
\end{example}

\begin{definition}\label{def:functor_preserving_a_property}
  A functor $F$ \emph{preserves} the property $P$ over maps $f_i$ and objects $A_j$ when
  $P(f_1,\ldots,f_n, A_1,\ldots,A_m)$ implies $P(F(f_1),\ldots,F(f_n), F(A_1),\ldots,F(A_m))$.
\end{definition}

\begin{definition}\label{def:functor_reflects_a_property}
  A functor $F$ \emph{reflects} the property $P$ over maps $f_i$ and objects $A_j$ when
  $P(F(f_1),\ldots,F(f_n), F(A_1),\ldots,F(A_m))$ implies $P(f_1,\ldots,f_n, A_1,\ldots,A_m)$.
\end{definition}

For example, all functors preserve the properties of being an idempotent or a retration or section,
but in general, not the property of being monic.

A functor $F:\C \to \D$ induces a map between hom-objects in $\C$ and hom-objects in $\D$. For
each object $A,B$ in $\C$ we have the map:
\[
  F_{AB} : \C(A,B) \to \D(F(A),F(B)).
\]

\begin{definition}\label{def:full_functor_faithful_functor}
  Given a functor $F:\C to \D$, we say:
  \begin{itemize}
    \item $F$ is \emph{faithul} when for all $A,B$, $F_{AB}$ is an injective function;
    \item $F$ is \emph{full} when  for all $A,B$, $F_{AB}$ is an surjective function.
  \end{itemize}
\end{definition}



\begin{definition}\label{def:natural_transformation}
  Given functors $F,G:\X \to \Y$, a \emph{natural transformation} $\alpha:F \natto G$ is a collection
  of maps in $\Y$, $\alpha_X : F(X) \to G(X)$, indexed by the objects of $\X$ such that for all
  $f:X_1 \to X_2$ in $\X$ the following diagram in $\Y$ commutes:
  \[\xymatrix @R+10pt @C+10pt{
      F(X_1) \ar[r]^{F(f)} \ar[d]_{\alpha_{X_1}} & F(X_2) \ar[d]^{\alpha_{X_2}}\\
      G(X_1) \ar[r]_{G(f)} &  G(X_2)
    }
  \]
\end{definition}
% subsection functors_and_natural_transformations (end)


% section categories (end)
\section{Restriction categories} % (fold)
\label{sec:restriction_categories}


Restriction categories were introduced in
 \cite{cockett2002:restcategories1} as a convenient axiomatization of partial maps.
\begin{definition}
  A \emph{restriction category} is a category \X\ together with a \emph{restriction operator} on
  maps:
  \[
    \infer{\restr{f}:A\to A}{f:A \to B}
  \]
  where $f$ is an map of \X\ and $A,B$ are objects of \X, such that the
  following four \emph{restriction identities} hold, whenever the
  compositions\footnote{Note that composition is
  written in diagrammatic order throughout this paper.} are defined.
  \begin{align*}
    &\rone\ \restr{f} f = f & &
    \rtwo\ \restr{g}  \restr{f} = \restr{f}  \restr{g}\\
    &\rthree\ \restr{\restr{f}  g} = \restr{f}   \restr{g} & &
    \rfour\  f \restr{g} = \restr{f g} f
  \end{align*}
\end{definition}

\begin{definition}
  A \emph{restriction functor} is a functor which preserves the restriction. That is,
  given a functor $F: \X \to \Y$ with \X\  and \Y\ restriction categories,
  $F$ is a restriction functor if:
  \[
    F(\restr{f}) = \restr{F(f)}.
  \]
\end{definition}

Any map such that $r=\restr{r}$ is an idempotent, as $\rst{r}\rst{r} = \rst{\rst{r} r} = \rst{r}$,
and is called a \emph{restriction idempotent}. All maps $\restr{f}$ are restriction idempotents as
$\rst{f}=\rst{\rst{f}}$. Below, we record some basic facts for restriction categories
shown in \cite{cockett2002:restcategories1} pp 4-5:
\begin{lemma}\label{lem:identities_involving_restriction}
  In a restriction category \X,
  \begin{multicols}{2}
    \begin{enumerate}[{(}i{)}]
      \item{}$\rst{f}$ is idempotent;
      \item{} $\rst{f g} = \rst{f g} \, \rst{f}$;\label{lemsub:restriction_identities_two}
      \item{} $\rst{f g} = \rst{f \rst{g}}$ ;
      \item{} $\rst{\rst{f}} = \rst{f}$;
      \item{} $\rst{f}\,\rst{g} = \rst{\rst{f}\,\rst{g}}$;
      \item{} $f$ monic implies $\rst{f} = 1$;
      \item{} $f = \rst{g} f \implies \rst{g}\,\rst{f} = \rst{f}$.
      \\
    \end{enumerate}
  \end{multicols}
\end{lemma}

A map $f:A\to B$ in a restriction category is said to be \emph{total} when
$\rst{f} = 1_A$. The total maps in a restriction category form a subcategory
$Total(\X) \subseteq \X$.

An example of a restriction category is \Par, the category with objects sets and arrows the
partial functions between sets. In \Par, the restriction of $f:A\to B$ is:
\[
  \rst{f}(x) =
  \begin{cases}
    x&\text{if $f(x)$ is defined,}\\
    \uparrow&\text{if }f(x)\text{ is }\uparrow.
  \end{cases}
\]
(The symbol $\uparrow$ means that the function is undefined at that element). In \Par, the
total maps correspond precisely to the functions that are defined on all elements of the domain.


\subsection{Enrichment and meets} % (fold)
\label{sub:enrichment_and_meets}


In any restriction category, there is a partialorder on each hom-set, given by $f \le g$ iff
$\restr{f} g = f$, where $f,g:A\to B$.

\begin{lemma}\label{lem:restriction_cats_are_partial_order_enriched}
  In a restriction category \X:
  \begin{enumerate}[{(}i{)}]
    \item  $\le$ as defined  above is a partial order on each hom-set;
    \item $f \le g \implies \restr{f} \le \restr{g}$;
    \item $f \le g \implies h f \le h g$;
    \item $f \le g \implies f h \le g h$;
    \item $f \le 1 \iff f = \restr{f}$.
  \end{enumerate}
\end{lemma}
\begin{proof}
  \prepprooflist
  \begin{enumerate}[{(}i{)}]
    \item With $f,g,h$ parallel maps in \X, each of the requirements for a partial order is
      shown below:
      \begin{description}
        \itembf{Reflexivity:} $\restr{f} f = f$ and therefore, $ f \le f$.
        \itembf{Anti-Symmetry:} Given $\restr{f}g = f$ and $\restr{g}f = g$, it follows:
          \[
            f = \restr{f} f = \restr{\restr{f} g} f = \restr{f}\, \restr{g} f
            = \restr{g}\restr{f} f =  \restr{g} f = g.
          \]
        \itembf{Transitivity:} Given $f \le g$ and $g\le h$,
          \[
            \restr{f} h = \restr{\restr{f} g} h = \restr{f}\, \restr{g} h = \restr{f} g = f
          \]
          showing that $f \le h$.
      \end{description}
    \item The premise is that $\restr{f} g = f$. From this,
      $ \restr{f}\, \restr{g} = \restr{\restr{f} g} = \restr{f}$, showing
      $\restr{f} \le \restr{g}$.
    \item $\restr{h f} hg = h \restr{f} g = h f$ and therefore $h f \le hg$.
    \item $\restr{f} g = f$, this shows  $\restr{f h} g h = \restr{\restr{f} g h} g h
      = \restr{f}\, \restr{g h} g h = \restr{f} g h = f h$ and therefore $f h \le g h$.
    \item As $f \le 1$ means precisely $\restr{f}1 = f$.
  \end{enumerate}
\end{proof}

Lemma \vref{lem:restriction_cats_are_partial_order_enriched} shows that restriction
categories are enriched in partial orders.

\begin{definition}
  A restriction category has \emph{meets} if there is an operation $\cap$ on parallel maps:
  \[
    \infer{A\xrightarrow{f\cap g} B}
      {A\overset{f}{\underset{g}{\rightrightarrows}}B}
  \]
  such that $f\cap g \le f, f\cap g \le g, f\cap f = f, h (f\cap g) = h f \cap hg$.
\end{definition}

Meets were introduced in \cite{cockett-guo-hofstra-2012:range2}.
The following are basic results on meets:

\begin{lemma}
  \label{lem:properties_of_meets_in_restriction_categories}
  In a restriction category \X with meets, where $f, g, h$ are maps in
  \X, the following are true:
  \begin{enumerate}[{(}i{)}]
    \item $f\le g \text{ and } f \le h \iff f \le g\cap h$;
        \label{lemsub:properties_of_meets_one}
    \item $f\cap g = g \cap f$;\label{lemsub:properties_of_meets_two}
    \item $\restr{f\cap 1} = f \cap 1$;\label{lemsub:properties_of_meets_three}
    \item $(f \cap g) \cap h = f \cap (g \cap h)$;
    \item $r(f\cap g) = r f \cap g$ where $r=\rst{r}$ is a restriction idempotent;
    \item $(f\cap g)r = f r \cap g$ where $r=\rst{r}$ is a restriction idempotent;
    \item $\restr{f\cap g} \le \restr{f}$ (and therefore $\restr{f\cap g} \le \restr{g}$);
    \item $ (f \cap 1) f = f \cap 1$;
    \item $ e(e \cap 1) = e$ where $e$ is idempotent.
  %\item $ e \cap e' = e e'$
  \end{enumerate}
\end{lemma}
\begin{proof}
  \prepprooflist
  \begin{enumerate}[{(}i{)}]
    \item $f\le g \text{ and } f \le h$ means precisely $f = \restr{f} g$ and $f = \restr{f} h$.
      Therefore,
      \[
        \restr{f} (g\cap h) =  \restr{f} g \cap \restr{f} h =  f\cap f = f
      \]
      and so $f \le g \cap h$. Conversely, given $f \le g\cap h$, we have
      $f = \restr{f} (g\cap h) = \restr{f} g \cap \restr{f} h \le \restr{f} g $. But
      $f \le \restr{f} g$ means $f = \restr{f}\,\restr{f} g = \restr{f}g$ and therefore
      $f \le g$. Similarly, $f \le h$.
    \item From \vref{lemsub:properties_of_meets_one}, as by definition, $f\cap g \le g$ and
      $f \cap g \le f$.
    \item $f\cap 1 = \restr{f\cap 1} (f \cap 1)= (\restr{f \cap 1} f ) \cap (\restr{f \cap 1})
      \le \restr{f \cap 1}$ from which the result follows. %def of $\le$, \rthree and \rone
    \item By definition and transitivity, $(f\cap g)\cap h \le f, g, h$ therefore by
      \vref{lemsub:properties_of_meets_one} $(f \cap g) \cap h \le f \cap (g \cap h)$. Similarly,
      $f \cap (g \cap h) \le(f \cap g) \cap h$ giving the equality.
    \item Given  $r f \cap g \le r f$, calculate:
      \[
        r f\cap g
        = \restr{r f\cap g} r f
        = \restr{r (r f\cap g)} f
        = \restr{r r f\cap r g} f
        = \restr{r (f\cap g)} f
        = r \restr{f\cap g} f
        = r (f\cap g).
      \]
    \item Using the previous point with the restriction idempotent $\restr{f r}$,
      \begin{equation*}
        \begin{split}
          f r \cap g
          = f \restr{r} \cap g   %%r rest id
          = \restr{f r }f \cap g  %% R.4
          = \restr{f r}(f\cap g)   %Prev
          = \restr{f r}\, \restr{f\cap g} f \\ % meet <=
          = \restr{f\cap g}\, \restr{f r} f % R2
          = \restr{f\cap g} f \restr{r}  %R4
          = (f\cap g) r. % meet, r rest id
        \end{split}
      \end{equation*}
    \item For the first claim,
      \[
        \restr{f\cap g}\, \restr{f} =\restr{\restr{f}(f\cap g)}\\
        =\restr{(\restr{f}f)\cap g} =\restr{f\cap g}.
      \]
      The second claim then follows by \vref{lemsub:properties_of_meets_two}.
    \item Given $ f \cap 1 \leq f$:
      \[
        f \cap 1 \leq f \iff  \restr{f \cap 1} f = f \cap 1 \iff  (f \cap 1) f = f \cap 1
      \]
      where the last step is by item \vref{lemsub:properties_of_meets_three} of this lemma.
    \item As $e$ is idempotent, $e (e\cap 1) = (e e \cap e) = e$.
  \end{enumerate}
\end{proof}
% subsection enrichment_and_meets (end)
\subsection{Partial monics, sections and isomorphisms} % (fold)
\label{sub:restricted_monics_sections_and_partial_isomorphisms}

Partial isomorphisms play a central role in this paper and below we develop
some their basic properties.

\begin{definition}
  A map $f$ in a restriction category \X is said:
  \begin{itemize}
    \item To be a \emph{partial isomorphism} when there is a \emph{partial inverse}, written
      $\inv{f}$ with $f\inv{f} =\restr{f}$ and $\inv{f}f = \restr{\inv{f}}$;
    \item To be a \emph{partial monic} if $h f = k f \implies h \restr{f} = k \restr{f}$;
    \item To be a \emph{partial section} if there exists an  $h$ such that $f h = \restr{f}$;
    \item To be a \emph{restriction monic} if it is a section $s$ with a retraction
      $r$ such that $r s = \restr{r s}$.
  \end{itemize}
\end{definition}

\begin{lemma}
  \label{lem:rcs_partial_monic_section_inverse_properties}
  In a restriction category:
  \begin{enumerate}[{(}i{)}]
    \item $f,\ g$ partial monic implies $f g$ is partial monic;
    \item $f$ a partial section implies $f$ is partial monic;
    \item $f,\ g$ partial sections implies $f g$ is a partial section;
    \item The partial inverse of $f$, when it exists, is unique;
    \item If $f,\ g$ have partial inverses and $f\,g$ exists, then $f\,g$ has a partial inverse;
    \item A restriction monic $s$ is a partial isomorphism.
  \end{enumerate}
\end{lemma}
\begin{proof}
  \prepprooflist
  \begin{enumerate}[{(}i{)}]
    \item Suppose $h f g = k f g$. As $g$ is partial monic, $h f \restr{g} = k f \restr{g}$.
      Therefore:
      \begin{align*}
        h \restr{f g} f &= k \restr{f g} f &\rfour\\
        h \restr{f g}\,\restr{f} &= k \restr{f g}\, \restr{f} & f\text{partial monic}\\
        h \restr{fg}&= k \restr{fg} & \text{Lemma \ref{lem:identities_involving_restriction},
          \ref{lemsub:restriction_identities_two}}
      \end{align*}
    \item Suppose $g f = k f$. Then, $g\restr{f} = g f h = k f h = k \restr{f}$.
    \item We have $f h = \restr{f}$ and $g h' = \restr{g}$. Therefore,
      \begin{align*}
        f g h' h &= f \restr{g} h & g \text{ partial section}\\
        &= \restr{f g} f h & \rfour\\
        &= \restr{f g}\, \restr{f} & f \text{ partial section}\\
        &= \restr{f}\, \restr{f g} & \rtwo\\
        &= \restr{\restr{f}f g} & \rthree\\
        &= \restr{f g} & \rone
      \end{align*}
    \item Suppose both $\inv{f}$ and $f^*$ are partial inverses of $f$. Then,
      \begin{multline*}
        \inv{f}
        = \restr{\inv{f}}\inv{f} %R.1
        =\inv{f}f\inv{f}  %Assumption, inverse is \inv{f}
        = \inv{f} \restr{f}   %Assumption, inverse is \inv{f}
        = \inv{f} f f^*   %Assumption, inverse is f^*
        = \inv{f} f \restr{f^*} f^*  \\ %R.1
        = \restr{\inv{f}}\restr{f^*} f^*   %Assumption, inverse is \inv{f}
        = \restr{f^*}\restr{\inv{f}} f^* %R.2
        = f^* f \restr{\inv{f}}  f^* %Assumption, inverse is f^*
        = f^* f \inv{f} f f^* %Assumption, inverse is \inv{f}
        = f^* f f^* %Assumption, inverse is \inv{f} and R.1
        = f^* %Assumption, inverse is f^*
      \end{multline*}
    \item For $f:A\to B,\ g:B\to C$ with partial inverses $\inv{f}$ and $\inv{g}$ respectively,
      the partial inverse of $f g$ is $\inv{g} \inv{f}$. Calculating $f g \inv{g} \inv{f}$
      using all the restriction identities:
      \[
        f g \inv{g} \inv{f} = f \restr{g} \inv{f} = \restr{f g} f \inv{f} =
        \restr{f g}\, \restr{f} = \restr{f}\, \restr{f g} = \restr{\restr{f} f g} = \restr{f g}.
      \]
      The calculation of $\inv{g} \inv{f} f g = \restr{\inv{g} \inv{f}}$ is similar.
    \item The partial inverse of $s$ is $\restr{r s}\,r$. First, note
      that $\restr{\restr{r s}\,r}
      = \restr{r s}\,\restr{r}
      = \restr{r}\, \restr{r s}
      = \restr{\restr{r}\,r s}
      = \restr{r s}$.
      Then, it follows that $(\restr{r s}\,r) s
      = r s\,= \restr{r s}
      = \restr{\restr{r s}r} $ and
      $s (\restr{r s}\,r)
      = s r \restr{s} %sr = 1 as r is the retraction of the section s
      = \restr{s}$.
  \end{enumerate}
\end{proof}


A restriction category in which every map is a partial
isomorphism is called an \emph{inverse category}.

An interesting property of inverse categories:

\begin{lemma}
  \label{lem:inverse_idempotents_are_restriction_idempotents}
  In an inverse category, all idempotents are restriction idempotents.
\end{lemma}
\begin{proof}
  Given an idempotent $e$,
  \[
    \rst{e} = e\inv{e} = e e \inv{e} = e \rst{e} = \rst{e e} e = \rst{e} e = e.
  \]
\end{proof}
% subsection restricted_monics_sections_and_partial_isomorphisms (end)
\subsection{Split restriction categories} % (fold)
\label{sub:split_restriction_categories}

The split restriction category, $\spl{E}{\X}$  is defined as:
\category{$(A,e)$, where $A$ is an object of \X, $e:A\to A$ and $e\in E$.}
  {$f:(A,d)\to(B,e)$ is given by $f:A\to B$ in \X, where $f = d\uts f e$.}
  {The map $e$ for $(A,e)$.}
  {inherited from \X.}
This is the standard idempotent splitting construction, also known as the Karoubi
envelope.

Note that for $f:(A,d)\to(B,e)$, by definition, in \X we have $f=d\uts f e$, giving
\[
  d\uts f = d(d\uts f e) = d\uts d\uts f e = d\uts f e =f\
  \text{ and }\  f e = (d\uts f e)e = d\uts f e\uts e = d\uts f e = f.
\]
When \X is a restriction category, there is an immediate candidate for a restriction in
$\spl{E}{\X}$. If $f\in\spl{E}{\X}$ is $e_1 f e_2$ in $\X$, then define $\restr{f}$ as
given by $e_1 \restr{f}$ in \X. Note that for $f:(A,d)\to(B,e)$, in \X we have:
\[
  d\uts\restr{f} = \restr{d\uts f} d = \restr{f} d.
\]
\begin{proposition}\label{prop:spleisarestrictioncat}
  If \X is a restriction category and $E$ is a set of idempotents, then
  the restriction as defined above makes $\spl{E}{\X}$ a restriction category.
\end{proposition}
\begin{proof}
  The restriction takes $f:(A,e_1)\to (B,e_2)$ to an endomorphism of $(A,e_1)$. The restriction
  is in $\spl{E}{\X}$ as
  \[
    e_1 (e_1\restr{f}) e_1 = e_1 \restr{f} e_1
    = \restr{e_1 f} e_1 e_1
    = \restr{e_1 f} e_1
    = e_1 \restr{ f}.
  \]

  Checking the 4 restriction axioms:
  \begin{align*}
    &[\text{{\bfseries R.1}}]\  \llbracket\restr{f}f\rrbracket = e_1 \restr{f} f
    = e_1 f = \llbracket f\rrbracket\\
    %
    & [\text{{\textbf{R.2}}}]\ \llbracket\restr{g}\restr{f}\rrbracket =
    e_1\restr{g}  e_1\restr{f}
    = e_1 e_1\restr{g}  \restr{f} = e_1 e_1\restr{f}  \restr{g}
    = e_1\restr{f}  e_1\restr{g}  = \llbracket\restr{f}\restr{g}\rrbracket\\
    %
    & [\text{{\textbf{R.3}}}]\ \llbracket\restr{\restr{f} g } \equiv
    e_1 \restr{e_1 \restr{f}  g}
    =  \restr{e_1 e_1 \restr{f} g} e_1
    =  \restr{e_1 \restr{f} g} e_1
    =  e_1 \restr{\restr{f} g}
    = e_1 \restr{f}\restr{g}
    = e_{1}e_{1}\restr{f}\restr{g}
    = e_1 \restr{f}e_1\restr{g}
    = \llbracket\restr{f}\, \restr{g}\rrbracket\\
    %
    &[\text{{\textbf{R.4}}}]\  \llbracket f \restr{g} \rrbracket =
     e_1f e_2 \restr{g}
    = \restr{e_1 f e_2 g} e_1 f e_2
    = \restr{e_1 e_1 f e_2 g} e_1 e_1 f e_2 \\
    & \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \quad
    = e_1 \restr{ e_1 f e_2 g} e_1 f e_2
    = e_1 \restr{f g} e_1 f e_2
    = \llbracket\restr{f g} f\rrbracket
  \end{align*}
\end{proof}

Given this, provided all identity maps are in $E$, $\spl{E}{\X}$ is a
restriction category with $\X$ as a full sub-restriction category, via
the embedding defined by taking an object $A$ in \X to  the object $(A,1)$
in $\spl{E}{\X}$.  Furthermore, the property of being an inverse category is
preserved by splitting.

\begin{lemma}\label{lem:the_idempotent_splitting_of_an_inverse_category_is_an_inverse_category}
  When \X is an inverse category, $\spl{E}{X}$ is an inverse category.
\end{lemma}
\begin{proof}
  The inverse of $f:(A,e_1)\to(B,e_2)$   in \spl{E}{\X} is $e_2\inv{f}e_1$ as
  \[
    \llbracket f \inv{f} \rrbracket = e_1 f e_2 e_2 \inv{f} e_1
    = e_1 e_1 f e_2 \inv{f} e_1
    = e_1 f  \inv{f} e_1
    = e_1 e_1 \restr{f} e_1
    = e_1 \restr{f}
    = \llbracket\restr{f}\rrbracket
  \]
  and
  \begin{multline*}
    \llbracket \inv{f} f\rrbracket=
    e_2 \inv{f} e_1 e_1 f e_2
    = e_2 \inv{f} e_1 f e_2 e_2
    = e_2 \inv{f} f  e_2\\
    = e_2 e_2 \restr{\inv{f}}  e_2
    = e_2 \restr{\inv{f}}
    = \llbracket\restr{\inv{f}}\rrbracket
  \end{multline*}

\end{proof}

\begin{proposition}\label{pro:in_rc_x_with_meets_split_x_is_cong_to_split_r_x}
  In a restriction category \X, with meets, let $R$ be the set of restriction idempotents.
  Then, $\spl{}{\X} \cong \spl{R}{\X}$(where \spl{}{\X} is the split of \X over all idempotents).
  Furthermore, $\spl{R}{\X}$ has meets.
\end{proposition}
\begin{proof}
  The proof below first shows the equivalence of the two categories, then addresses the claim
  that $\spl{R}{\X}$ has meets.

  For equivalence, we require two functors,
  \[
    U:\spl{R}{\X}\to\spl{}{\X}\text{ and }V:\spl{}{\X}\to\spl{R}{\X},
  \]
  with:
  \begin{align}
    U V \cong I_{\spl{R}{\X}}\\
    V U \cong I_{\spl{}{\X}}.
  \end{align}


  $U$ is the standard inclusion functor. $V$ will take the object $(A,e)$ to
  $(A,e\cap 1)$ and the map $f:(A,e_1)\to (B,e_2)$ to $(e_1\cap 1)f $.

  $V$ is a functor as:
  \begin{description}
    \itembf{Well Defined:} If  $f:(A,e_1) \to (B,e_2)$, then
      $(e_1\cap 1) f $ is a map in \X from $A$ to $B$ and
      $ (e_1\cap 1)(e_1\cap 1) f  (e_2 \cap 1) =
      (e_1\cap 1) (f  e_2 \cap f ) = (e_1\cap 1) (f \cap f)= (e_1\cap 1) f$, therefore,
      $V(f):V((A,e_1)) \to V((B,e_2))$.
    \itembf{Identities:} $V(e) = (e\cap 1 ) e = e \cap 1$ by
      lemma \vref{lem:properties_of_meets_in_restriction_categories}.
    \itembf{Composition:} $V(f) V(g)
      = (e_1\cap 1 ) f (e_2 \cap 1) g
      = (e_1\cap 1 ) f e_2 (e_2 \cap 1) g
      = (e_1\cap 1 ) f  (e_2 \cap e_{2}) g
      = (e_1\cap 1 ) f e_2 g
      = (e_1\cap 1 ) f g
      = V(f g)$.
  \end{description}

  Recalling from Lemma \vref{lem:properties_of_meets_in_restriction_categories}, $(e\cap 1)$
  is a restriction idempotent. Using this fact, the commutativity of restriction idempotents
  and the general idempotent identities from
  \vref{lem:properties_of_meets_in_restriction_categories}, the composite functor $U V$ is
  the identity on $\spl{r}{\X}$ as when $e$ is a restriction idempotent,
  $e = e (e\cap 1) = (e\cap 1) e = (e\cap 1)$.

  For the other direction,  note that for a particular idempotent $e:A\to A$,  this gives the
  maps $e:(A,e)\to(A,e\cap 1)$ and $e\cap 1 : (A,e\cap 1) \to (A,e)$, again by
  \vref{lem:properties_of_meets_in_restriction_categories}. These maps give the natural
  isomorphism between $I$ and $V U$ as
  \[
    \xymatrix{
      (A,e)\ar[r]^e \ar[dr]_{e} &(A,e\cap 1)\ar[d]^{e\cap 1}\\
      &(A,e)
    }\qquad \text{ and  }\qquad
    \xymatrix{
      (A,e\cap 1)\ar[r]^{e\cap 1} \ar[dr]_{e\cap 1} &(A,e)\ar[d]^{e}\\
      &(A,e\cap 1)
    }
  \]
  both commute. Therefore, $U V = I$ and $V U \cong I$, giving an equivalence of the categories.

  For the rest of this proof, the bolded functions, e.g., $\mbf$ are in $\spl{R}{\X}$.
  Italic functions, e.g., $f$ are in \X.

  To show that $\spl{R}{\X}$ has meets,  designate the meet in $\spl{R}{\X}$ as \capspl
  and define $\mbf \capspl \mbg$ as the map given by the \X map $f \cap g$, where
  $\mbf,\mbg:(A,d)\to(B,e)$ in $\spl{R}{\X}$ and $f,g:A\to B$ in \X . This is
  a map in $\spl{R}{\X}$ as
  $d(f \cap g)e = (d\uts f \cap d\uts g) e = (f \cap g) e = (f e \cap g) = f\cap g$
  where the penultimate equality is by
  \vref{lem:properties_of_meets_in_restriction_categories}.
  By definition $\restr{\mbf \capspl \mbg }$ is $d\restr{f\cap g}$.

  It is necessary to show \capspl satisfies the four meet properties.
  \begin{itemize}
    \item{$\mbf\capspl \mbg \le \mbf$: } We need to show
      $\rst{\mbf \capspl \mbg} \mbf =  \mbf \capspl \mbg$.  Calculating now in \X:
      \begin{align*}
        d \rst{f \cap g} f&= \rst{d(f\cap g)} d f\\
        & = \rst{df \cap dg} df \\
        & = \rst{f \cap g} f \\
        & = f \cap g
      \end{align*}
      which is the definition of $\mbf \capspl \mbg$.
    \item{$\mbf\capspl \mbg \le \mbg$: } Similarly and once again calculating in \X,
      \begin{align*}
        d \rst{f \cap g} g&= \rst{d(f\cap g)} d g\\
        & = \rst{df \cap dg} dg \\
        & = \rst{f \cap g} g \\
        & = f \cap g
      \end{align*}
      which is the definition of $\mbf \capspl \mbg$.
    \item{$\mbf\capspl \mbf = \mbf$: } From the definition, this is $f \cap f = f$ which
      is just $ \mbf$.
    \item{$\mbh(\mbf\capspl \mbg) = \mbh\mbf \capspl \mbh\mbg$: }
      From the definition, this is given in \X by $ h (f \cap g) =
      h f \cap h g$ which in $\spl{R}{\X}$ is $\mbh\mbf \capspl \mbh\mbg$.
  \end{itemize}
\end{proof}
% subsection split_restriction_categories (end)



\subsection{Partial Map Categories} % (fold)
\label{sub:partial_map_categories}

In \cite{cockett2002:restcategories1}, it is shown that split restriction categories are
equivalent to \emph{partial map categories}. The main definitions and results related to
partial map categories are given below.

\begin{definition}
  A collection $\Mstab$ of monics is \emph{a stable system of monics}
  when it includes all isomorphisms, is closed under composition and is
  pullback stable.
\end{definition}

\emph{Stable} in this definition means that if $m:A\to B$ is in \Mstab, then for arbitrary
$b$ with codomain $B$, the pullback
\[
  \xymatrix{
    A'\ar[r]^a \ar[d]_{m'} &A\ar[d]^{m}\\
    B' \ar[r]_{b} & B
  }
\]
exists and $m' \in \Mstab$. A category that has a stable system of monics
is referred to as an \Mstab-category.

\begin{lemma}
  If $nm \in \Mstab$, a stable system of monics, and $m$ is monic, then $n \in \Mstab$.
\end{lemma}
\begin{proof}
  The commutative square
  \[
    \xymatrix{
      A\ar[d]_n \ar[r]^{1} &A\ar[d]^{nm}\\
      A' \ar[r]_{m} & B
    }
  \]
  is a pullback.
\end{proof}

Given a category \C and a stable system of monics, the \emph{partial map category},
$\text{Par}(\C,\Mstab)$ is:
  \rcategoryequiv{$A\in\C$}
    {$(m,f):A\to B$  with $m:A' \to A$ is in \Mstab and $f:A' \to B$ is a map in \C. i.e.,
      $\xymatrix @R-15pt @C-15pt{&A'\ar[dl]_{m} \ar[dr]^{f}\\A&&B}$.}
    {$1_A,1_A:A \to A$}
    {via a pullback, $(m,f)(m',g) = (m'' m, f' g)$ where
      \[
        \xymatrix @C-15pt @R-15pt{
          &&A''\ar[dl]_{m''}\ar[dr]^{f'}\\
          &A'\ar[dl]_{m}\ar[dr]_{f}&\text{{\tiny (pb)}}&B'\ar[dl]^{m'}\ar[dr]^{g}\\
          A&&B&&C
        }
      \]
    }
    {$\restr{(m,f)} = (m,m)$}

For the maps, $(m,f) \sim (m',f')$ when there is an isomorphism $\gamma : A'' \to A'$
such that $\gamma m' = m$ and $\gamma f' = f$.

In \cite{cockettlack2003:restcategories2}, it is shown that:
\begin{theorem}[Cockett-Lack]
  Every restriction category is a full subcategory of a partial map category.
\end{theorem}
% subsection partial_map_categories (end)
\subsection{Restriction products and Cartesian restriction categories} % (fold)
\label{sub:restriction_products_and_cartesian_restriction_categories}


Restriction categories have analogues of products and terminal objects.

\begin{definition}
  In a restriction category \X\, a \emph{restriction product}  of two objects $X, Y$ is an
  object $X\times Y$ equipped with \emph{total} projections
  $\pi_0:X\times Y\to X, \pi_1:X\times Y\to Y $ where:
  \begin{quote}
    $\forall f:Z\to X, g: Z\to Y,\quad \exists$ a unique $\<f,g\>:Z \to X\times Y$ such that
    \begin{itemize}
      \item $\<f,g\> \pi_0 \le f$,
      \item $\<f,g\> \pi_1 \le g$ and
      \item $\restr{\<f,g\>} = \restr{f}\, \restr{g} ( = \restr{g}\, \restr{f})$.
    \end{itemize}
  \end{quote}
\end{definition}

\begin{definition}
  In a restriction category \X\, a \emph{restriction terminal object}
  is an object $\top$ such that $\forall X$, there is a
  unique total map $!_X : X \to \top$ and the diagram
  \[
    \xymatrix @C=40pt @R=25pt{
      X \ar[r]^{\restr{f}} \ar[d]^{f} & X \ar[r]^{!_X}  &\top  \\
      Y \ar[urr]_{!_Y}
    }
  \]
  commutes. That is,  $f\, !_Y = \restr{f}\, !_X$. Note this implies
  that a restriction terminal object is unique up to a unique isomorphism.
\end{definition}

\begin{definition}
  A restriction category \X\ is \emph{Cartesian} if it has all restriction products
  and a restriction terminal object.
\end{definition}

\begin{definition}
  An object $A$ in a Cartesian restriction category is \emph{discrete}
  when the diagonal map,
  \[
    \Delta:A \to A \times A
  \]
  is a partial isomorphism.

  A Cartesian restriction category is \emph{discrete} when every object is discrete.
\end{definition}

\begin{theorem}\label{thm:a_crc_is_discrete_iff_it_has_meets}
  A Cartesian restriction category \X is discrete if and only if it has meets.
\end{theorem}
\begin{proof}
  If \X has meets, then
  \[
    \Delta(\pi_0 \cap \pi_1) = \Delta\pi_0 \cap \Delta\pi_1 = 1\cap 1 = 1
  \]
  and as $\<\pi_0,\pi_1\>$ is identity,
  \begin{align*}
    \restr{\pi_0 \cap \pi_1} &= \restr{\pi_0 \cap \pi_1} \<\pi_0, \pi_1\> \\
    &=\<\rst{\pi_0 \cap \pi_1}\pi_0, \rst{\pi_0 \cap \pi_1}\pi_1\>\\
    &=\<\pi_0 \cap \pi_1,\pi_0 \cap \pi_1\>\\
    &=(\pi_0 \cap \pi_1 )\Delta
  \end{align*}
  and therefore, $\pi_0 \cap \pi_1$ is $\inv{\Delta}$.

  For the other direction, set $f\cap g = \<f,g\>\inv{\Delta}$.
  By the definition of the restriction product:
  \[
    f \cap g =  \<f,g\>\inv{\Delta} =\<f,g\>\inv{\Delta} \Delta \pi_0 =
      \<f,g\>\restr{\inv{\Delta}}\pi_0 \le \<f,g\>\pi_0 \le f
  \]
  Similarly, substituting $\pi_1$ for $\pi_0$ above, this gives $f \cap g \le g$.
  For the left distributive law,
  \[
    h(f \cap g) = h \<f,g\>\inv{\Delta} =  \<h f,h g\>\inv{\Delta} = h f \cap h g
  \]
  and finally an intersection of a map with itself is
  \[
    f\cap f = \<f,f\> \inv{\Delta} = (f \Delta) \inv{\Delta} = f \restr{\Delta} = f
  \]
  as $\Delta$ is total. This shows that $\cap$ as defined above is a meet for the
  Cartesian restriction category \X.

\end{proof}

We shall refer to a Cartesian restriction category in which every object is
discrete as simply a discrete restriction category.
% subsection restriction_products_and_cartesian_restriction_categories (end)

\subsection{Graphic Categories} % (fold)
\label{sub:graphic_categories}


In a Cartesian restriction category, a map $A\xrightarrow{f}B$ is
called \emph{graphic} when the maps
\[
  A\xrightarrow{\<f,1\>}B\times A\qquad \text{and}\qquad
  A\xrightarrow{\<\rst{f},1\>}A\times A
\]
have partial inverses. A Cartesian restriction category is \emph{graphic} when all of its maps
are graphic.
\begin{lemma}\label{lem:graphic_maps_are_closed_in_a_cartesian_restriction_category}
  In a Cartesian restriction category:
  \begin{enumerate}[{(}i{)}]
    \item Graphic maps are closed under composition;
    \item Graphic maps are closed under the restriction;
    \item An object is discrete if and only if its identity map is graphic.
  \end{enumerate}
\end{lemma}
\begin{proof}
  \prepprooflist
  \begin{enumerate}[{(}i{)}]
    \item To show closure, it is necessary to show that $\<f g,1\>$ has a partial inverse.
      By Lemma \vref{lem:rcs_partial_monic_section_inverse_properties}, the uniqueness of the
      partial inverse gives
      \[
        \inv{(\<f,1\> ; \<g,1\>\times 1)} = \inv{\<g,1\>} \times 1 ; \inv{\<f,1\>} .
      \]
      By the definition of the restriction product, $\rst{\<f g,1\>} = \rst{f g}$. Additionally,
      a straightforward calculation shows that
        $\rst{\<f,1\>;\<g,1\> \times 1} =
          \rst{\<f\<g,1\>, 1\>} = \rst{f ;\< g,1\>}
          = \rst{\<f;g, f\>} = \rst{f g}\,\rst{f} = \rst{f g}
        $
      where the last equality is by \rtwo, \rthree and finally \rone.

    Consider the diagram
    \[
      \xymatrix @C+35pt @R+20pt{
        A \ar[r]^{\<f,1\>} \ar[drr]_{\<f g,1\>} &
           B \times A  \ar[r]^{\<g,1\> \times 1}
           &  C \times B \times A \\
        &&C \times A \ar[u]_{1 \times \<f,1\>}
      }
    \]

    From this:
    \begin{align*}
      \<f g,1\>  (1\times \<f,1\>) ( \inv{\<g,1\>}\times 1) \inv{\<f,1\>}
      &=\<f,1\>(\<g,1\>\times 1 ) (\inv{\<g,1\>}\times 1) \inv{\<f,1\>}\\
      &=\<f,1\> (\rst{g\times 1}) \inv{\<f,1\>}\\
      &=\rst{\<f,1\> (g\times 1)}  \<f,1\> \inv{\<f,1\>}\\
      &=\rst{\<f,1\> (g\times 1)}  \rst{\<f,1\>}\\
      &= \rst{\<f,1\>} \rst{\<f,1\>(g\times 1)}\\
      &= \rst{\<f,1\> (g\times 1)}\\
      &= \rst{\<f g,1\>}(=\restr{f g})\\
    \end{align*}
    showing that $1\times \<f,1\>  (\inv{\<g,1\>}\times 1 ) \inv{\<f,1\>}$ is
    a right inverse for $\<f g,1\>$.

    For the other direction, note that in general $\inv{h k} = \inv{k}\inv{h}$ and that
    we have $\<f g,1\> = \<f,1\> (\<g,1\>\times 1)  (1 \times \inv{\<f,1\>})$, thus
    $(1\times \<f,1\>)  (\inv{\<g,1\>}\times 1) \inv{\<f,1\>}$ will also be a left inverse and
    $\<f g,1\>$ is a restriction isomorphism.

    \item This follows from the definition of graphic and that
       $\rst{\<f,1\>} = \rst{f} = \restr{\rst{f}}$.

    \item Given a discrete object $A$, the map $1_A$ is graphic as $\<1_A,1\> = \Delta$
      and therefore $\inv{\<1,1\>} = \inv{\Delta}$. Conversely, if $\<1_A,1\>$ has an inverse,
      then $\Delta = \<1_A,1\>$ has that same inverse and therefore the object is discrete.
  \end{enumerate}
\end{proof}

\begin{lemma}\label{lem:a_discrete_crc_is_precisely_a_graphic_crc}
  A discrete restriction category is precisely a graphic Cartesian restriction category.
\end{lemma}
\begin{proof}
  The requirement is that $\<f,1\>$ (and $\<\rst{f},1\>$) each have partial inverses. For
  $\<f,1\>$, the inverse is $\rst{(1 \times f)\inv{\Delta}} \pi_1$.

  To show this, calculate  the two compositions. First,
  \[
    \<f,1\> \rst{1 \times f \inv{\Delta}} \pi_1 =
      \rst{\<f,f\> \inv{\Delta}}\<f,1\>\pi_1 % use R.4
    = \rst{f \Delta \inv{\Delta}}\<f,1\>\pi_1 % product
    = \rst{f}\<f,1\>\pi_1 % Delta total
    = \rst{f}.% product
  \]
  The other direction is:
  \begin{align*}
    \rst{(1 \times f)\inv{\Delta}} \pi_1 \<f,1\>
      &= \< \rst{(1 \times f)\inv{\Delta}} \pi_1 f ,
      \rst{(1 \times f)\inv{\Delta}}\pi_1 \>\\ %pdt defn
    &= \< \rst{(1 \times f)\inv{\Delta}} (1 \times f) \pi_1,
      \rst{(1 \times f)\inv{\Delta}}\pi_1 \>\\ %pi total, natural
    &= \< (1 \times f )\rst{\inv{\Delta}} \pi_1 ,
      \rst{(1 \times f)\inv{\Delta}}\pi_1 \>\\ %R.4
    &= \< (1 \times f) \rst{\inv{\Delta}} \pi_0 ,
      \rst{(1 \times f)\inv{\Delta}}\pi_1 \>\\ %below
    &= \< \rst{(1 \times f)\inv{\Delta}} (1 \times f) \pi_0,
      \rst{(1 \times f)\inv{\Delta}}\pi_1 \>\\ %R.4
  %  &= \< \rst{(1 \times f)\inv{\Delta}}\,
  %     \rst{(1 \times f)} \pi_0, \rst{(1 \times f)\inv{\Delta}}\pi_1 \>\\
    &= \< \rst{(1 \times f)\inv{\Delta}} \pi_0,
      \rst{(1 \times f)\inv{\Delta}}\pi_1 \>\\ %(a x b);pi0 = a
    &= \rst{(1 \times f)\inv{\Delta}} \< \pi_0, \pi_1 \>\\ % products
    &= \rst{(1 \times f)\inv{\Delta}}
  \end{align*}
  The one tricky step is to realize
  \begin{align*}
    \rst{\inv{\Delta}} \pi_1
      &= \inv{\Delta} \Delta \pi_1\\
      &= \inv{\Delta}\\
      &= \inv{\Delta} \Delta \pi_0\\
      &= \rst{\inv{\Delta}} \pi_0
  \end{align*}

  For $\<\rst{f},1\>$, the inverse is $\rst{(1 \times \rst{f})\inv{\Delta}} \pi_1$. Similarly
  to above,
  \[
    \<\rst{f},1\> \rst{1 \times \rst{f} \inv{\Delta}} \pi_1 =
      \rst{\<\rst{f},\rst{f}\> \inv{\Delta}}\<\rst{f},1\>\pi_1 % use R.4
    = \rst{\rst{f} \Delta \inv{\Delta}}\<\rst{f},1\>\pi_1 % product
    = \rst{\rst{f}}\<\rst{f},1\>\pi_1 % Delta total
    = \rst{f}.% product
  \]
  The other direction follows the same pattern as for $\<f,1\>.$
\end{proof}
% subsection graphic_categories (end)

% section restriction_categories (end)
